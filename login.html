<!-- login.html -->
<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>შესვლა • Zaratic RP</title>
  <link rel="icon" href="https://raw.githubusercontent.com/OGSunny/Testerweb/main/lv_0_20251120194047.jpg">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Georgian:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root { --accent:#e74c3c; --dark:#0f0f0f; --glass:rgba(20,20,30,0.9); --border:rgba(231,76,60,0.3); }
    body { font-family:'Noto Sans Georgian',sans-serif; background:#000; color:white; height:100vh; display:grid; place-items:center; }
    .box { background:var(--glass); border:1px solid var(--border); border-radius:12px; padding:30px 40px; width:360px; text-align:center; backdrop-filter:blur(20px); }
    img { width:80px; height:80px; border-radius:50%; margin-bottom:20px; }
    h1 { font-size:22px; color:var(--accent); margin-bottom:20px; }
    input { width:100%; padding:12px; margin:10px 0; background:rgba(255,255,255,0.05); border:1px solid var(--border); border-radius:8px; color:white; font-size:14px; }
    button { width:100%; padding:12px; background:var(--accent); border:none; border-radius:8px; color:white; cursor:pointer; font-size:14px; margin-top:10px; position: relative; }
    button.loading::after { content: ''; border: 2px solid white; border-top: 2px solid transparent; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; position: absolute; top: 50%; right: 10px; transform: translateY(-50%); }
    .switch { margin-top:15px; font-size:13px; }
    .switch a { color:var(--accent); cursor:pointer; }
    .error { color: #f44336; font-size: 13px; margin-top: 10px; background: rgba(244,67,54,0.1); padding: 5px; border-radius: 4px; }
    .remember { display: flex; align-items: center; gap: 5px; font-size: 13px; color: #b0b0b0; margin: 10px 0; }
    .remember input { width: auto; margin: 0; }
  </style>
</head>
<body>
  <div class="box">
    <img src="https://raw.githubusercontent.com/OGSunny/Testerweb/main/lv_0_20251120194047.jpg">
    <h1 id="title">შესვლა</h1>
    <form id="form">
      <input type="text" id="user" placeholder="მომხმარებელი" required minlength="3">
      <input type="password" id="pass" placeholder="პაროლი" required minlength="4">
      <label class="remember"><input type="checkbox" id="remember"> დამახსოვრება</label>
      <button type="submit" id="btn">შესვლა</button>
    </form>
    <div class="switch">არ გაქვს ანგარიში? <a id="toggle">რეგისტრაცია</a></div>
    <div class="error" id="error"></div>
  </div>

  <script>
    const worker = 'https://data.jemalagegidze.workers.dev';
    let login = true;
    if (localStorage.getItem('username')) location.href = 'forum.html';

    document.getElementById('toggle').onclick = () => {
      login = !login;
      document.getElementById('title').textContent = login ? 'შესვლა' : 'რეგისტრაცია';
      document.getElementById('btn').textContent = login ? 'შესვლა' : 'რეგისტრაცია';
      document.querySelector('.switch').innerHTML = login ? 'არ გაქვს ანგარიში? <a id="toggle">რეგისტრაცია</a>' : 'უკვე გაქვს? <a id="toggle">შესვლა</a>';
      document.getElementById('toggle').onclick = arguments.callee;
      document.getElementById('error').textContent = '';
    };

    document.getElementById('form').onsubmit = async e => {
      e.preventDefault();
      const btn = document.getElementById('btn');
      btn.classList.add('loading');
      btn.disabled = true;
      const u = document.getElementById('user').value.trim();
      const p = document.getElementById('pass').value;
      if (u.length < 3 || p.length < 4) {
        document.getElementById('error').textContent = 'შეამოწმეთ ველები';
        btn.classList.remove('loading');
        btn.disabled = false;
        return;
      }
      const path = login ? '/login' : '/register';
      try {
        const res = await fetch(worker + path, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'შეცდომა');
        localStorage.setItem('username', u);
        location.href = 'forum.html';
      } catch (error) {
        document.getElementById('error').textContent = error.message;
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    };
  </script>
</body>
</html>
