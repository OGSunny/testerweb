<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>სექცია • Zaratic Role Play</title>
    <link rel="icon" href="https://raw.githubusercontent.com/OGSunny/Testerweb/main/lv_0_20251120194047.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Georgian:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <style>
        :root{--bg:#0a0a10;--card:rgba(25,25,45,.96);--accent:#e91e63;--glow:#ff4081;--border:rgba(233,30,99,.3);--text:#fff;--muted:#bbb}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Noto Sans Georgian',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
        header{position:fixed;top:0;width:100%;background:rgba(15,15,35,.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);z-index:1000;padding:15px 0}
        .nav{max-width:1400px;margin:auto;display:flex;justify-content:space-between;align-items:center;padding:0 25px}
        .back{color:var(--text);text-decoration:none;display:flex;align-items:center;gap:10px;font-size:18px}
        .back:hover{color:var(--accent)}
        main{margin-top:90px;max-width:1100px;margin:auto;padding:20px}
        .breadcrumb{margin-bottom:20px;color:var(--muted);font-size:14px}
        .breadcrumb a{color:var(--accent);text-decoration:none}
        h1{font-size:28px;margin-bottom:25px;color:var(--accent);display:flex;align-items:center;gap:12px}
        .new-post{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:25px;margin-bottom:30px}
        input,textarea{width:100%;background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:12px;padding:14px;color:#fff;margin:10px 0;font-family:inherit;transition:.3s}
        input:focus,textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 20px rgba(233,30,99,.4)}
        textarea{min-height:140px;resize:vertical}
        .btns{display:flex;gap:12px;margin-top:15px}
        button{padding:12px 24px;background:var(--accent);border:none;border-radius:12px;color:#fff;cursor:pointer;font-weight:600;transition:.3s}
        button:hover{background:var(--glow);transform:translateY(-3px)}
        button.secondary{background:transparent;border:1px solid var(--accent);color:var(--accent)}
        .post{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:25px;margin-bottom:20px;display:grid;grid-template-columns:160px 1fr;gap:25px}
        .author{text-align:center}
        .avatar{width:90px;height:90px;border-radius:50%;background:var(--accent);display:grid;place-items:center;font-size:36px;font-weight:bold;margin:0 auto 12px;box-shadow:0 0 30px var(--glow)}
        .name{color:var(--accent);font-weight:600;font-size:18px;margin-bottom:5px}
        .role{padding:4px 10px;background:rgba(233,30,99,.2);border-radius:8px;font-size:12px;display:inline-block}
        .content{position:relative}
        .date{font-size:13px;color:var(--muted);margin-bottom:10px}
        .title{font-size:20px;margin-bottom:12px;color:var(--accent)}
        .text{line-height:1.7;color:var(--text);white-space:pre-wrap}
        .actions{margin-top:15px;display:flex;gap:15px;align-items:center;flex-wrap:wrap}
        .actions button{background:none;border:none;color:var(--muted);cursor:pointer;display:flex;align-items:center;gap:6px;font-size:14px;transition:.2s}
        .actions button:hover,.actions .liked{color:var(--accent)}
        .replies{margin-top:20px;padding-top:20px;border-top:1px solid var(--border)}
        .reply{background:rgba(255,255,255,.03);padding:15px;border-radius:12px;margin-bottom:12px}
        .reply-header{display:flex;align-items:center;gap:10px;font-size:13px;color:var(--muted);margin-bottom:8px}
        .reply-avatar{width:32px;height:32px;border-radius:50%;background:var(--accent);display:grid;place-items:center;font-size:14px}
        .empty,.loading{text-align:center;padding:50px;color:var(--muted);font-size:16px}
        .loading i{animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        @media(max-width:768px){.post{grid-template-columns:1fr}.author{border-bottom:1px solid var(--border);padding-bottom:20px;margin-bottom:20px}}
    </style>
</head>
<body>
    <header>
        <div class="nav">
            <a href="forum.html" class="back"><i class="fas fa-arrow-left"></i> უკან</a>
            <div></div>
        </div>
    </header>
    <main>
        <div class="breadcrumb"><a href="forum.html">მთავარი</a> → <span id="secName"></span></div>
        <h1 id="title"></h1>

        <div class="new-post" id="newPostForm">
            <input type="text" id="postTitle" placeholder="სათაური" required>
            <textarea id="postContent" placeholder="ტექსტი..."></textarea>
            <div class="btns">
                <button onclick="createPost()">გამოქვეყნება</button>
                <button class="secondary" onclick="cancelEdit()">გაუქმება</button>
            </div>
        </div>

        <div id="posts"></div>
    </main>

    <script>
        const worker='https://data.jemalagegidze.workers.dev';
        const user=localStorage.username;
        if(!user) location='login.html';
        const url=new URL(location.href);
        const section=url.searchParams.get('id');
        const sections={rules:"სერვერის წესები",news:"სიახლეები",updates:"განახლებები",suggestions:"წინადადებები",events:"ივენთები",biographies:"ბიოგრაფიები",'complaints-admin':"საჩივრები ადმინზე",'complaints-player':"საჩივრები მოთამაშეზე",appeals:"აპელაციები",unban:"განბლოკვა",'vacancies-leaders':"ლიდერები",'vacancies-admin':"ადმინები",'vacancies-partner':"პარტნიორები",'donation-help':"დონატი",'tech-help':"ტექ. დახმარება",general:"დისკუსია"};
        const locked=['rules','news','updates'];
        const admins=['Zviadi Gegidze','Nika Georgadze','Admin'];

        document.getElementById('title').textContent=sections[section]||section;
        document.getElementById('secName').textContent=sections[section]||section;
        if(locked.includes(section) && !admins.includes(user)) document.getElementById('newPostForm').style.display='none';

        function color(name){let h=0;for(let i=0;i<name.length;i++)h=name.charCodeAt(i)+((h<<5)-h);const c=['#e91e63','#9c27b0','#673ab7','#3f51b5','#2196f3','#00bcd4','#009688','#4caf50','#ff9800','#ff5722'];return c[Math.abs(h)%c.length]}

        function time(t){const d=new Date(t),n=Date.now()-t;if(n<6e4)return'ახლახანს';if(n<36e5)return Math.floor(n/6e4)+' წთ';if(n<864e5)return Math.floor(n/36e5)+' სთ';if(n<6048e5)return Math.floor(n/864e5)+' დღე';return d.toLocaleDateString('ka-GE',{hour:'2-digit',minute:'2-digit'})}

        async function load(){
            const posts=await fetch(`${worker}/?section=${section}`).then(r=>r.json());
            posts.sort((a,b)=>b.timestamp-a.timestamp);
            const container=document.getElementById('posts');
            if(!posts.length){container.innerHTML='<div class="empty">თემები ჯერ არ არის</div>';return}
            container.innerHTML=posts.map(p=>`
                <div class="post">
                    <div class="author">
                        <div class="avatar" style="background:${color(p.author)}">${p.author[0].toUpperCase()}</div>
                        <div class="name">${p.author}</div>
                        <div class="role">${admins.includes(p.author)?'ადმინი':'მოთამაშე'}</div>
                    </div>
                    <div class="content">
                        <div class="date">${time(p.timestamp)}${p.edited?' (რედ.)':''}</div>
                        <div class="title">${p.title}</div>
                        <div class="text">${p.content.replace(/\n/g,'<br>')}</div>
                        <div class="actions">
                            <button onclick="like('${p.id}')"><i class="fas fa-heart ${p.likes?.includes(user)?'liked':''}"></i> ${p.likes?.length||0}</button>
                            ${p.author===user||admins.includes(user)?`<button onclick="edit('${p.id}','${p.title}','${p.content}')"><i class="fas fa-edit"></i></button><button onclick="del('${p.id}')"><i class="fas fa-trash"></i></button>`:''}
                        </div>
                        <div class="replies">
                            ${(p.replies||[]).map(r=>`
                                <div class="reply">
                                    <div class="reply-header"><div class="reply-avatar" style="background:${color(r.author)}">${r.author[0]}</div>${r.author} • ${time(r.timestamp)}</div>
                                    <div>${r.content.replace(/\n/g,'<br>')}</div>
                                </div>`).join('')}
                            <textarea placeholder="პასუხი..." id="reply-${p.id}"></textarea>
                            <button onclick="reply('${p.id}')">გაგზავნა</button>
                        </div>
                    </div>
                </div>`).join('');
        }

        async function createPost(){
            const t=document.getElementById('postTitle').value.trim();
            const c=document.getElementById('postContent').value.trim();
            if(!t||!c) return alert('შეავსეთ ველები');
            await fetch(worker,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'create',section,post:{author:user,title:t,content:c}})});
            document.getElementById('postTitle').value='';document.getElementById('postContent').value='';load();
        }

        window.edit=(id,t,c)=>{document.getElementById('postTitle').value=t;document.getElementById('postContent').value=c;
            window.currentEdit=id;document.querySelector('.btns button').onclick=async()=>{await fetch(worker,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'edit',section,id,title:document.getElementById('postTitle').value,content:document.getElementById('postContent').value,requestingUser:user})});load();cancelEdit();}
        };
        window.cancelEdit=()=>{document.getElementById('postTitle').value='';document.getElementById('postContent').value='';window.currentEdit=null;document.querySelector('.btns button').onclick=createPost};
        window.del=async id=>{if(confirm('წაშლა?')){await fetch(worker,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'delete',section,id,requestingUser:user})});load()}}
        window.like=async id=>{await fetch(worker,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'like',section,id,username:user})});load()}
        window.reply=async id=>{const txt=document.getElementById('reply-'+id).value.trim();if(!txt)return;await fetch(worker,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'reply',section,id,replyAuthor:user,replyContent:txt})});document.getElementById('reply-'+id).value='';load()}

        load();setInterval(load,20000);
    </script>
</body>
</html>
